import{r as o,j as e,u as E,a as P}from"./index-c84ed3dd.js";import{u as w}from"./SurveyHook-b4ebb6c0.js";import{S as F}from"./SurveyPreview-260653d0.js";import{u as H}from"./BuildingHook-e348fadb.js";import{M as d}from"./SuccessAlertModal-ddfe2b7d.js";import{S as O}from"./SearchBar-dfe0c3fe.js";import{L as T}from"./LoadingList-de1f9d80.js";import"./DoFetch-8c964e2e.js";import"./AnswerSurveyForm-79298a36.js";import"./ButtonLoading-64b4dce1.js";import"./ThemeProvider-daf8709f.js";import"./Fade-25b713ee.js";import"./divWithClassName-b536dd03.js";import"./index.esm-954b3aab.js";import"./iconBase-10fe07e4.js";import"./Button-a235a16b.js";import"./Button-b5cff543.js";const U=({surveyid:r,assignedSurveys:a,handleUpdate:g})=>{const{getAllBuildings:u}=H(),{assignSurveyToBuildings:y}=w(),[c,m]=o.useState([]),[l,h]=o.useState(""),[j,p]=o.useState(!1),[t,n]=o.useState([]),[x,_]=o.useState(!1),C=c.filter(s=>s.street.toLowerCase().includes(l.toLowerCase())||s.name.toLowerCase().includes(l.toLowerCase())||s.city.toLowerCase().includes(l.toLowerCase())||s.post_code.toLowerCase().includes(l.toLowerCase())),B=s=>{const{value:i,checked:v}=s.target;if(!v){k(Number(i));return}const f=c.find(S=>S.building_id===Number(i));t.find(S=>S.building_id===Number(i))||f&&(n([...t,f]),console.log("selected buildings: ",t))},L=s=>h(s.target.value),k=s=>{console.log("remove from selected: ",s),n(t.filter(i=>i.building_id!==s))},N=()=>{if(x){n([]),_(!1);return}n(c),_(!0)},A=async()=>{await y(t,r),b(),g(),n([])},M=()=>p(!0),b=()=>p(!1);return o.useEffect(()=>{(async()=>{const s=await u(),i=s.filter(v=>!a.some(f=>f.b_id===v.building_id));console.log("/assigned surveys: ",a),console.log("res: ",s),console.log("buildings: ",i),i&&m(i)})()},[a]),e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:M,children:"Lisää taloyhtiöt"}),e.jsxs(d,{show:j,onHide:b,scrollable:!0,children:[e.jsx(d.Header,{closeButton:!0,children:e.jsx(d.Title,{children:"Valitse taloyhtiöt"})}),e.jsx(d.Body,{children:e.jsxs("div",{className:"column",style:{position:"relative"},children:[e.jsxs("label",{style:{gap:"0.5rem"},className:"flex-row center-align",children:[e.jsx("div",{children:"Valitse kaikki"}),e.jsx("input",{onChange:()=>N(),checked:x,type:"checkbox"})]}),e.jsx(O,{placeholder:"Hae taloyhtiötä",handleSearch:L}),e.jsx("div",{children:C.map(s=>e.jsxs("div",{className:"flex-row",style:{justifyContent:"space-between"},children:[e.jsx("div",{style:{flex:1},children:s.name}),e.jsxs("div",{style:{flex:2},children:[s.street,", ",s.post_code,", ",s.city]}),e.jsx("input",{checked:t.some(i=>i.building_id===s.building_id),type:"checkbox",value:s.building_id,onChange:B})]},s.building_id))})]})}),e.jsx(d.Footer,{children:e.jsx("button",{onClick:A,children:"Lisää"})})]})]})},ie=()=>{const{surveyid:r}=E(),{getSurveyById:a,getAssignedSurveys:g}=w(),[u,y]=o.useState(),c=P(),[m,l]=o.useState([]),[h,j]=o.useState(0),p=()=>j(h+1);return o.useEffect(()=>{(async()=>{if(!r)return;y(await a(r));const n=(await g()).filter(x=>x.survey_id===Number(r));l(n)})()},[h]),u?e.jsxs("main",{className:"column",children:[e.jsxs("div",{className:"flex-row",children:[e.jsx(U,{surveyid:Number(r),assignedSurveys:m,handleUpdate:p}),e.jsx(F,{survey:u})]}),e.jsx(T,{children:m.map(t=>e.jsxs("div",{className:"list-item",children:[e.jsx("h4",{style:{flex:1},children:t.survey_title}),e.jsxs("div",{style:{flex:1},children:[t.street,", ",t.post_code,", ",t.city]}),e.jsx("button",{onClick:()=>c(`/manager/surveys/${r}/assigned/${t.assigned_survey_id}`),children:"Siirry"})]},t.assigned_survey_id))})]}):e.jsx("h1",{children:"Ei kyselyä"})};export{ie as default};
