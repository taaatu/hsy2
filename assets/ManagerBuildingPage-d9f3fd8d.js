import{r as n,a as b,j as e,u as k}from"./index-fdb54680.js";import{u as v}from"./BuildingHook-15bc61e1.js";import{u as P,F as l}from"./FormFieldError-c2d8c63e.js";import{c as w,d as B,C as y}from"./DoFetch-44b224c4.js";import{S as C}from"./SuccessAlertModal-5fd775de.js";import{u as M}from"./SurveyHook-b77241ea.js";import{L as F}from"./LoadingList-60ef1896.js";import"./iconBase-ee127de4.js";import"./ThemeProvider-52d28998.js";import"./Fade-70f01c49.js";import"./divWithClassName-6209a725.js";import"./index.esm-30964094.js";import"./Button-7b9df5bd.js";import"./Button-7ee1d97b.js";const T=({building:r})=>{var f,j;const[t,i]=n.useState(!1),[u,d]=n.useState(!1),c=b(),{modifyBuilding:m,deleteBuilding:p}=v(),{register:s,handleSubmit:g,setError:x,reset:S,formState:{errors:o}}=P({defaultValues:r}),E=async()=>{if(await p(String(r.building_id))instanceof y){x("root",{type:"serverError",message:"Taloyhtiön poistaminen epäonnistui"});return}c("/manager/properties")},N=async a=>{console.log("modify building data:",a);const h=await m(a);if(h instanceof y){const _=h.status===409?"Taloyhtiö on jo olemassa":"Palvelinvirhe";x("root",{type:"serverError",message:_});return}d(!0),i(!1)};return e.jsxs("form",{className:"color3 column",onSubmit:g(N),children:[e.jsx(C,{show:u,message:"Taloyhtiön tiedot muokattu"}),e.jsxs("label",{children:["Osoite",e.jsx("input",{className:"line",...s("street",{required:{value:!0,message:"Osoite vaaditaan"},disabled:!t})}),e.jsx(l,{error:o.street})]}),e.jsxs("label",{children:["Postinumero",e.jsx("input",{className:"line",...s("post_code",{required:{value:!0,message:"Postinumero vaaditaan"},pattern:{value:w,message:"Postinumeron tulee olla 5 numeroa pitkä"},disabled:!t})}),e.jsx(l,{error:o.post_code})]}),e.jsxs("label",{children:["Kaupunki",e.jsx("select",{...s("city",{required:!0,disabled:!t}),children:B.map(a=>e.jsx("option",{children:a},a))})]}),e.jsxs("label",{children:["Nimi",e.jsx("input",{className:"line",...s("name",{required:{value:!0,message:"Nimi vaaditaan"},disabled:!t})}),e.jsx(l,{error:o.name})]}),((f=o.root)==null?void 0:f.serverError)&&e.jsx(l,{error:(j=o.root)==null?void 0:j.serverError}),e.jsxs("div",{className:"flex-row",children:[t?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>{i(!1),S()},children:"Poistu"}),e.jsx("button",{type:"submit",children:"Tallenna"})," "]}):e.jsx("button",{type:"button",onClick:()=>i(!0),children:"Muokkaa"}),e.jsx("button",{type:"button",style:{marginLeft:"auto"},className:"delete",onClick:E,children:"Poista"})]})]})},Q=()=>{const{buildingid:r}=k(),{getBuildingById:t}=v(),[i,u]=n.useState(),[d,c]=n.useState([]),m=b(),{getAssignedSurveys:p}=M();if(n.useEffect(()=>{r&&(async()=>{u(await t(r));const s=(await p()).filter(g=>g.b_id===Number(r));c(s)})()},[]),i)return e.jsxs("main",{className:"column",children:[e.jsx(T,{building:i}),e.jsxs(F,{children:[e.jsx("h3",{className:"padding1",children:"Kyselyt"}),d.map(s=>e.jsxs("div",{className:"list-item",children:[e.jsx("h4",{style:{flex:1},children:s.survey_title}),e.jsxs("div",{style:{flex:1},children:[s.street,", ",s.post_code,", ",s.city]}),e.jsx("button",{onClick:()=>m("/manager/surveys/"+s.assigned_survey_id),children:"Siirry"})]},s.assigned_survey_id))]})]})};export{Q as default};
