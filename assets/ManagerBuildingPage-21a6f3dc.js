import{r as n,a as b,j as e,u as M,M as C,U as k}from"./index-e95d5965.js";import{u as v}from"./BuildingHook-2615143d.js";import{u as P,F as d}from"./FormFieldError-a4819356.js";import{c as w,d as B,C as y}from"./DoFetch-a9cf7fe3.js";import{S as F}from"./SuccessAlertModal-9760b608.js";import{u as T}from"./SurveyHook-1be97117.js";import{L as I}from"./LoadingList-52dc23f3.js";import"./iconBase-de053acb.js";import"./ThemeProvider-f75a7bb0.js";import"./Fade-1ec5f89e.js";import"./divWithClassName-ed702d6a.js";import"./index.esm-1f466b1a.js";import"./Button-0cd090e0.js";import"./Button-520bd067.js";const q=({building:i})=>{var f,j;const[r,a]=n.useState(!1),[c,m]=n.useState(!1),g=b(),{modifyBuilding:p,deleteBuilding:x}=v(),{register:t,handleSubmit:s,setError:u,reset:S,formState:{errors:l}}=P({defaultValues:i}),_=async()=>{if(await x(String(i.building_id))instanceof y){u("root",{type:"serverError",message:"Taloyhtiön poistaminen epäonnistui"});return}g("/manager/properties")},E=async o=>{console.log("modify building data:",o);const h=await p(o);if(h instanceof y){const N=h.status===409?"Taloyhtiö on jo olemassa":"Palvelinvirhe";u("root",{type:"serverError",message:N});return}m(!0),a(!1)};return e.jsxs("form",{className:"color3 column",onSubmit:s(E),children:[e.jsx(F,{show:c,message:"Taloyhtiön tiedot muokattu"}),e.jsxs("label",{children:["Osoite",e.jsx("input",{className:"line",...t("street",{required:{value:!0,message:"Osoite vaaditaan"},disabled:!r})}),e.jsx(d,{error:l.street})]}),e.jsxs("label",{children:["Postinumero",e.jsx("input",{className:"line",...t("post_code",{required:{value:!0,message:"Postinumero vaaditaan"},pattern:{value:w,message:"Postinumeron tulee olla 5 numeroa pitkä"},disabled:!r})}),e.jsx(d,{error:l.post_code})]}),e.jsxs("label",{children:["Kaupunki",e.jsx("select",{...t("city",{required:!0,disabled:!r}),children:B.map(o=>e.jsx("option",{children:o},o))})]}),e.jsxs("label",{children:["Nimi",e.jsx("input",{className:"line",...t("name",{required:{value:!0,message:"Nimi vaaditaan"},disabled:!r})}),e.jsx(d,{error:l.name})]}),((f=l.root)==null?void 0:f.serverError)&&e.jsx(d,{error:(j=l.root)==null?void 0:j.serverError}),e.jsxs("div",{className:"flex-row",children:[r?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>{a(!1),S()},children:"Poistu"}),e.jsx("button",{type:"submit",children:"Tallenna"})," "]}):e.jsx("button",{type:"button",onClick:()=>a(!0),children:"Muokkaa"}),e.jsx("button",{type:"button",style:{marginLeft:"auto"},className:"delete",onClick:_,children:"Poista"})]})]})},Q=()=>{const{buildingid:i}=M(),{getBuildingById:r}=v(),[a,c]=n.useState(),[m,g]=n.useState([]),p=b(),{getAssignedSurveys:x}=T(),{curentUser:t}=n.useContext(C);if(n.useEffect(()=>{i&&(async()=>{c(await r(i));const s=(await x()).filter(u=>u.b_id===Number(i));g(s)})()},[]),a)return e.jsxs("main",{className:"column",children:[e.jsx(q,{building:a}),e.jsxs(I,{children:[e.jsx("h3",{className:"padding1",children:"Kyselyt"}),m.map(s=>e.jsxs("div",{className:"list-item",children:[e.jsx("h4",{style:{flex:1},children:s.survey_title}),e.jsxs("div",{style:{flex:1},children:[s.street,", ",s.post_code,", ",s.city]}),e.jsx("button",{onClick:()=>p((t==null?void 0:t.user_group)===k.ADMIN?`/admin/surveys/${s.survey_id}/assigned/${s.assigned_survey_id}`:`/manager/surveys/${s.survey_id}/assigned/${s.assigned_survey_id}`),children:"Siirry"})]},s.assigned_survey_id))]})]})};export{Q as default};
