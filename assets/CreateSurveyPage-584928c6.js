import{r as n,j as e,u as V}from"./index-c84ed3dd.js";import{u as y,c as v}from"./ThemeProvider-daf8709f.js";import{C as Q}from"./Nav-6004309c.js";import{f as B}from"./divWithClassName-b536dd03.js";import{d as J}from"./index.esm-954b3aab.js";import{A as P,a as z,b as G}from"./DoFetch-8c964e2e.js";import{u as X}from"./SurveyHook-b4ebb6c0.js";import{S as Y}from"./SurveyPreview-260653d0.js";import{B as Z}from"./ButtonLoading-64b4dce1.js";import{T as ee,a as C}from"./Tabs-096af4f0.js";import{S as se}from"./SuccessAlertModal-ddfe2b7d.js";import{F as d,u as ae,a as te,C as re}from"./FormFieldError-6fa1ba42.js";import"./Fade-25b713ee.js";import"./Button-b5cff543.js";import"./iconBase-10fe07e4.js";import"./AnswerSurveyForm-79298a36.js";const oe="_container_1du86_1",ne="_dot_1du86_7",ie="_selectWeight_1du86_23",le="_previewTop_1du86_33",de="_form_1du86_49",ue="_optionInput_1du86_57",ce="_createsurveybuttons_1du86_67",me="_overlay_1du86_79",ye="_input_1du86_105",ve="_dates_1du86_121",pe="_questionCard_1du86_133",he="_tabsBar_1du86_149",c={container:oe,dot:ne,selectWeight:ie,previewTop:le,form:de,optionInput:ue,createsurveybuttons:ce,overlay:me,input:ye,dates:ve,questionCard:pe,tabsBar:he},b=n.forwardRef(({className:s,bsPrefix:a,as:t="div",...r},o)=>(a=y(a,"card-body"),e.jsx(t,{ref:o,className:v(s,a),...r})));b.displayName="CardBody";const T=b,F=n.forwardRef(({className:s,bsPrefix:a,as:t="div",...r},o)=>(a=y(a,"card-footer"),e.jsx(t,{ref:o,className:v(s,a),...r})));F.displayName="CardFooter";const xe=F,K=n.forwardRef(({bsPrefix:s,className:a,as:t="div",...r},o)=>{const l=y(s,"card-header"),m=n.useMemo(()=>({cardHeaderBsPrefix:l}),[l]);return e.jsx(Q.Provider,{value:m,children:e.jsx(t,{ref:o,...r,className:v(a,l)})})});K.displayName="CardHeader";const je=K,L=n.forwardRef(({bsPrefix:s,className:a,variant:t,as:r="img",...o},l)=>{const m=y(s,"card-img");return e.jsx(r,{ref:l,className:v(t?`${m}-${t}`:m,a),...o})});L.displayName="CardImg";const _e=L,R=n.forwardRef(({className:s,bsPrefix:a,as:t="div",...r},o)=>(a=y(a,"card-img-overlay"),e.jsx(t,{ref:o,className:v(s,a),...r})));R.displayName="CardImgOverlay";const Ne=R,A=n.forwardRef(({className:s,bsPrefix:a,as:t="a",...r},o)=>(a=y(a,"card-link"),e.jsx(t,{ref:o,className:v(s,a),...r})));A.displayName="CardLink";const fe=A,ge=B("h6"),H=n.forwardRef(({className:s,bsPrefix:a,as:t=ge,...r},o)=>(a=y(a,"card-subtitle"),e.jsx(t,{ref:o,className:v(s,a),...r})));H.displayName="CardSubtitle";const Ce=H,E=n.forwardRef(({className:s,bsPrefix:a,as:t="p",...r},o)=>(a=y(a,"card-text"),e.jsx(t,{ref:o,className:v(s,a),...r})));E.displayName="CardText";const Se=E,qe=B("h5"),D=n.forwardRef(({className:s,bsPrefix:a,as:t=qe,...r},o)=>(a=y(a,"card-title"),e.jsx(t,{ref:o,className:v(s,a),...r})));D.displayName="CardTitle";const we=D,U=n.forwardRef(({bsPrefix:s,className:a,bg:t,text:r,border:o,body:l=!1,children:m,as:i="div",...p},h)=>{const x=y(s,"card");return e.jsx(i,{ref:h,...p,className:v(a,x,t&&`bg-${t}`,r&&`text-${r}`,o&&`border-${o}`),children:l?e.jsx(T,{children:m}):m})});U.displayName="Card";const f=Object.assign(U,{Img:_e,Title:we,Subtitle:Ce,Body:T,Link:fe,Text:Se,Header:je,Footer:xe,ImgOverlay:Ne}),$e=({index:s,register:a,remove:t})=>e.jsxs(f,{children:[e.jsxs(f.Header,{as:"h4",children:["Kysymys ",s+1]}),e.jsxs(f.Body,{children:[e.jsx("textarea",{placeholder:"Kysymys",className:c.input,...a(`questions.${s}.question`,{required:{value:!0,message:"Kysymys vaaditaan"}})}),e.jsxs("div",{className:"column",style:{gap:"0.5rem"},children:[e.jsxs("div",{className:"center-align",children:[e.jsx("span",{className:c.dot}),e.jsx("input",{className:`${c.optionInput} line`,type:"text",placeholder:"Vastaus 1",...a(`questions.${s}.option_1`,{required:{value:!0,message:"1. vastausvaihtoehto vaaditaan"}})}),e.jsx("div",{children:"+1"})]}),e.jsxs("div",{className:"center-align",children:[e.jsx("span",{className:c.dot}),e.jsx("input",{className:`${c.optionInput} line`,type:"text",placeholder:"Vastaus 2",...a(`questions.${s}.option_2`,{required:{value:!0,message:"2. vastausvaihtoehto vaaditaan"}})}),e.jsx("div",{children:"+0,5"})]}),e.jsxs("div",{className:"center-align",children:[e.jsx("span",{className:c.dot}),e.jsx("input",{className:`${c.optionInput} line`,type:"text",placeholder:"Vastaus 3",...a(`questions.${s}.option_3`,{required:{value:!0,message:"3. vastausvaihtoehto vaaditaan"}})}),e.jsx("div",{children:"0"})]})]})]}),e.jsx(f.Footer,{children:e.jsx("button",{onClick:()=>t(s),className:"delete",children:e.jsx(J,{})})})]});var g=(s=>(s.PUBLISHED="published",s.UNPUBLISHED="unpublished",s))(g||{});const Ie=({errors:s,questions:a})=>{var t,r,o,l;return e.jsxs(e.Fragment,{children:[e.jsx(d,{error:(t=s.survey_header)==null?void 0:t.survey_title}),e.jsx(d,{error:(r=s.survey_header)==null?void 0:r.start_time}),e.jsx(d,{error:(o=s.survey_header)==null?void 0:o.end_time}),e.jsx(d,{error:(l=s.survey_header)==null?void 0:l.description}),s.questions&&a.map((m,i)=>{var p,h,x,j;return e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"error",children:["Kysymys ",i+1]}),e.jsx(d,{error:s.questions&&((p=s.questions[i])==null?void 0:p.question)}),e.jsx(d,{error:s.questions&&((h=s.questions[i])==null?void 0:h.option_1)}),e.jsx(d,{error:s.questions&&((x=s.questions[i])==null?void 0:x.option_2)}),e.jsx(d,{error:s.questions&&((j=s.questions[i])==null?void 0:j.option_3)})]})})]})},k={question:"",option_1:P,option_2:z,option_3:G},Ve=()=>{var q,w,$,I;const{surveyid:s}=V(),[a,t]=n.useState(!1),[r,o]=n.useState(""),{createSurvey:l,getSurveyById:m}=X(),{register:i,control:p,handleSubmit:h,reset:x,getValues:j,formState:{errors:_}}=ae({defaultValues:{survey_header:{survey_status:g.UNPUBLISHED,start_time:new Date().toISOString().slice(0,10)},questions:[k]}}),{fields:S,append:W,remove:O}=te({control:p,name:"questions"}),M=async u=>{u.survey_header.survey_status=u.survey_header.survey_status===!0?g.PUBLISHED:g.UNPUBLISHED,console.log("data: ",u);const N=await l(u);N&&(o(N),t(!0))};return n.useEffect(()=>{console.log("surveyid: ",s),s&&(async()=>{const u=await m(s);u&&x(u)})()},[]),e.jsxs("main",{className:c.container,children:[e.jsx(se,{show:a,message:r,navRoute:"/admin/surveys"}),e.jsx("form",{onSubmit:h(M),className:`${c.form} color3`,children:e.jsxs(ee,{className:c.tabsBar,children:[e.jsx(C,{eventKey:"survey",title:"Tiedot",children:e.jsxs("div",{className:"column",style:{maxWidth:"60ch",gap:"1rem"},children:[e.jsxs("label",{className:"createsurveything",children:["Kyselyn nimi",e.jsx("input",{maxLength:40,className:"line",type:"text",placeholder:"Kyselyn nimi",...i("survey_header.survey_title",{required:{value:!0,message:"Kyselyn nimi vaaditaan"}})}),e.jsx(d,{error:(q=_.survey_header)==null?void 0:q.survey_title})]}),e.jsxs("div",{className:c.dates,children:[e.jsxs("label",{className:"createsurveything",children:["Alkaa",e.jsx("input",{type:"date",placeholder:"Alkaa",className:"line",...i("survey_header.start_time",{required:{value:!0,message:"Alkamispäivä vaaditaan"},min:{value:new Date().toISOString().slice(0,10),message:"Alkamispäivä ei voi olla menneisyydessä"}})}),e.jsx(d,{error:(w=_.survey_header)==null?void 0:w.start_time})]}),e.jsxs("label",{className:"createsurveything",children:["Päättyy",e.jsx("input",{type:"date",placeholder:"Päättyy",className:"line",...i("survey_header.end_time",{required:{value:!0,message:"Päättymispäivä vaaditaan"},min:{value:j().survey_header.start_time,message:"Päättymispäivä ei voi olla ennen alkamispäivää"}})}),e.jsx(d,{error:($=_.survey_header)==null?void 0:$.end_time})]})]}),e.jsxs("label",{className:"createsurveything",children:["Kuvaus",e.jsx("textarea",{placeholder:"Kuvaus",...i("survey_header.description",{required:{value:!0,message:"Kuvaus vaaditaan"}})}),e.jsx(d,{error:(I=_.survey_header)==null?void 0:I.description})]})]})}),e.jsx(C,{eventKey:"questions",title:"Kysymykset",id:"column",children:e.jsxs("div",{className:"column",children:[e.jsx("h3",{children:`Kysymyksiä (${S.length})`}),e.jsx("div",{className:"column",style:{gap:"1rem"},children:S.map((u,N)=>e.jsx(e.Fragment,{children:e.jsx($e,{index:N,register:i,control:p,remove:O},u.id)}))}),e.jsx("button",{type:"button",className:"colored",onClick:()=>W(k),children:"Lisää kysymys"})]})}),e.jsx(C,{eventKey:"create",title:"Luo kysely",children:e.jsxs("div",{className:"column color3 padding1",children:[e.jsxs("label",{className:"flex-row center-align",children:[e.jsx(re,{name:"survey_header.survey_status",control:p,rules:{required:!1},render:({field:u})=>e.jsx("input",{style:{height:"1rem",width:"1rem"},type:"checkbox",...u})}),"Jaa kysely isännöitsijöille"]}),e.jsxs("div",{className:"flex-row",children:[e.jsx(Y,{survey:j()}),e.jsx(Z,{text:"Luo kysely"})]}),e.jsx(Ie,{errors:_,questions:j().questions})]})})]})})]})};export{Ve as default};
